name: docs

on:
  push:
    branches: [main]
    tags: ["*"]

permissions:
  contents: read

jobs:
  docs:
    # Force Github action to run only a single job at a time (based on the group name)
    # This is to prevent race-condition in publishing a new version of doc to `gh-pages`
    concurrency:
      group: on-docs-rebuild
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
      - run: python -m pip install --upgrade wheel tox
      - name: Build docs website and API reference
        env:
          VERSION: ${{inputs.version}}
          ALIAS: ${{inputs.alias}}
        run: |
          tox -e docs -- deploy --push --update-aliases ${{env.VERSION}} ${{env.ALIAS}}
          tox -e docs -- set-default --push latest
